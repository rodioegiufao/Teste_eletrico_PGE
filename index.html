<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Visualizador 3D</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        #debug {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        canvas { 
            display: block; 
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <div id="debug">
        <h3>Debug Information</h3>
        <div id="status">Iniciando...</div>
    </div>
    <div id="canvas-container"></div>

    <!-- Mudei para módulos, então as referências de jsm podem ser importadas -->
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.132.2/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.132.2/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.132.2/examples/jsm/loaders/GLTFLoader.js';

        const status = document.getElementById('status');
        const debug = (message) => {
            status.innerHTML += `<br>${new Date().toLocaleTimeString()}: ${message}`;
            console.log(message);
        };

        // Teste 1: Verificar se Three.js carregou
        debug('1. Three.js carregado: ' + (typeof THREE !== 'undefined'));
        debug('2. GLTFLoader disponível: ' + (typeof GLTFLoader !== 'undefined'));
        debug('3. OrbitControls disponível: ' + (typeof OrbitControls !== 'undefined'));

        // Teste 2: Verificar se o arquivo existe
        debug('4. Testando acesso ao modelo.glb...');
        
        fetch('/modelo.glb')
            .then(response => {
                debug(`5. Status HTTP: ${response.status} ${response.statusText}`);
                debug(`6. Content-Type: ${response.headers.get('content-type')}`);
                debug(`7. Tamanho: ${response.headers.get('content-length')} bytes`);
                
                if (response.ok) {
                    return response.blob();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(blob => {
                debug(`8. ✅ Arquivo encontrado! Tamanho: ${blob.size} bytes`);
                
                // Teste 3: Tentar carregar o modelo
                debug('9. Iniciando Three.js...');
                
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x87CEEB);
                
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 0, 5);
                
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(800, 600);
                document.getElementById('canvas-container').appendChild(renderer.domElement);
                
                // Luzes básicas
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                scene.add(directionalLight);
                
                // Controles (agora instanciado corretamente)
                const controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                
                // Carregar modelo (instanciado corretamente)
                debug('10. Carregando modelo GLB...');
                const loader = new GLTFLoader();
                
                loader.load('/modelo.glb', 
                    (gltf) => {
                        debug('11. ✅ Modelo carregado com sucesso!');
                        scene.add(gltf.scene);
                        
                        // Animação
                        function animate() {
                            requestAnimationFrame(animate);
                            controls.update();
                            renderer.render(scene, camera);
                        }
                        animate();
                    },
                    (progress) => {
                        const percent = Math.round((progress.loaded / progress.total) * 100);
                        debug(`12. Progresso: ${percent}%`);
                    },
                    (error) => {
                        debug(`13. ❌ Erro no carregamento: ${error.message}`);
                        
                        // Tentar carregar via blob diretamente
                        debug('14. Tentando carregar via Blob...');
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            loader.parse(e.target.result, '', 
                                (gltf) => {
                                    debug('15. ✅ Modelo carregado via Blob!');
                                    scene.add(gltf.scene);
                                },
                                (error) => {
                                    debug(`16. ❌ Erro no parse: ${error.message}`);
                                }
                            );
                        };
                        reader.readAsArrayBuffer(blob);
                    }
                );
                
            })
            .catch(error => {
                debug(`17. ❌ Erro no fetch: ${error.message}`);
                
                // Testar caminhos alternativos
                const testPaths = ['./modelo.glb', 'modelo.glb', '/public/modelo.glb'];
                testPaths.forEach(path => {
                    fetch(path)
                        .then(r => debug(`18. Teste ${path}: ${r.status}`))
                        .catch(e => debug(`19. Teste ${path}: ERRO`));
                });
            });
    </script>
</body>
</html>
